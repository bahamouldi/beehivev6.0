"""
BeeWAF Mega Rules Database â€” Part 9
=====================================
Additional granular attack signatures: PHP functions, Java payloads,
Python/Ruby/Node attacks, cloud-specific, container escape, CI/CD,
email injection, log injection, open redirect, CORS abuse, and more.
~1600 additional patterns.
"""

# ============================================================================
# 1. PHP-SPECIFIC DEEP (250 patterns)
# ============================================================================
PHP_DEEP = [
    r"(?i)\beval\s*\(\s*\$_(?:GET|POST|REQUEST|COOKIE|SERVER|FILES|ENV|SESSION)\b",
    r"(?i)\bassert\s*\(\s*\$_(?:GET|POST|REQUEST|COOKIE|SERVER)\b",
    r"(?i)\bpreg_replace\s*\(\s*['\"][^'\"]*(?:/[a-z]*e[a-z]*/)",
    r"(?i)\bcreate_function\s*\(",
    r"(?i)\bcall_user_func\s*\(",
    r"(?i)\bcall_user_func_array\s*\(",
    r"(?i)\barray_map\s*\(\s*['\"](?:system|exec|passthru|shell_exec|popen|eval|assert)['\"]",
    r"(?i)\barray_filter\s*\(\s*['\"](?:system|exec|passthru|shell_exec|popen|eval|assert)['\"]",
    r"(?i)\barray_walk\s*\(\s*['\"](?:system|exec|passthru|shell_exec|popen|eval|assert)['\"]",
    r"(?i)\busort\s*\(\s*['\"](?:system|exec|passthru|shell_exec|popen|eval|assert)['\"]",
    r"(?i)\buasort\s*\(\s*['\"](?:system|exec|passthru|shell_exec|popen|eval|assert)['\"]",
    r"(?i)\buksort\s*\(\s*['\"](?:system|exec|passthru|shell_exec|popen|eval|assert)['\"]",
    r"(?i)\bsystem\s*\(",
    r"(?i)\bexec\s*\(\s*['\$]",
    r"(?i)\bpassthru\s*\(",
    r"(?i)\bshell_exec\s*\(",
    r"(?i)\bpopen\s*\(",
    r"(?i)\bproc_open\s*\(",
    r"(?i)\bproc_close\s*\(",
    r"(?i)\bproc_get_status\s*\(",
    r"(?i)\bproc_terminate\s*\(",
    r"(?i)\bproc_nice\s*\(",
    r"(?i)\bpcntl_exec\s*\(",
    r"(?i)\bpcntl_fork\s*\(",
    r"(?i)\bpcntl_signal\s*\(",
    r"(?i)\bpcntl_alarm\s*\(",
    r"(?i)\bpcntl_waitpid\s*\(",
    r"(?i)\bexec\s*\(\s*base64_decode\b",
    r"(?i)\bsystem\s*\(\s*base64_decode\b",
    r"(?i)\bpassthru\s*\(\s*base64_decode\b",
    r"(?i)\beval\s*\(\s*base64_decode\b",
    r"(?i)\beval\s*\(\s*gzinflate\b",
    r"(?i)\beval\s*\(\s*gzuncompress\b",
    r"(?i)\beval\s*\(\s*gzdecode\b",
    r"(?i)\beval\s*\(\s*str_rot13\b",
    r"(?i)\beval\s*\(\s*strrev\b",
    r"(?i)\beval\s*\(\s*substr\b",
    r"(?i)\beval\s*\(\s*chr\b",
    r"(?i)\beval\s*\(\s*pack\b",
    r"(?i)\beval\s*\(\s*hex2bin\b",
    r"(?i)\beval\s*\(\s*convert_uudecode\b",
    r"(?i)\bassert\s*\(\s*base64_decode\b",
    r"(?i)\binclude\s*\(\s*\$_(?:GET|POST|REQUEST|COOKIE)\b",
    r"(?i)\binclude_once\s*\(\s*\$_(?:GET|POST|REQUEST|COOKIE)\b",
    r"(?i)\brequire\s*\(\s*\$_(?:GET|POST|REQUEST|COOKIE)\b",
    r"(?i)\brequire_once\s*\(\s*\$_(?:GET|POST|REQUEST|COOKIE)\b",
    r"(?i)\binclude\s*\(\s*['\"](?:http|ftp|php|data|expect|zip|phar|glob|ssh2|rar)://",
    r"(?i)\brequire\s*\(\s*['\"](?:http|ftp|php|data|expect|zip|phar|glob|ssh2|rar)://",
    r"(?i)\bfile_get_contents\s*\(\s*['\"](?:http|ftp|php|data|expect|zip|phar|glob|ssh2|rar)://",
    r"(?i)\bfile_get_contents\s*\(\s*\$_(?:GET|POST|REQUEST|COOKIE)\b",
    r"(?i)\bfile_put_contents\s*\(",
    r"(?i)\bfopen\s*\(\s*\$_(?:GET|POST|REQUEST|COOKIE)\b",
    r"(?i)\bfread\s*\(",
    r"(?i)\bfwrite\s*\(",
    r"(?i)\bfgets\s*\(",
    r"(?i)\bfgetc\s*\(",
    r"(?i)\bfgetcsv\s*\(",
    r"(?i)\bfgetss\s*\(",
    r"(?i)\bfpassthru\s*\(",
    r"(?i)\bftruncate\s*\(",
    r"(?i)\bfputcsv\s*\(",
    r"(?i)\bfputs\s*\(",
    r"(?i)\bfile\s*\(\s*\$_(?:GET|POST|REQUEST|COOKIE)\b",
    r"(?i)\breadfile\s*\(\s*\$_(?:GET|POST|REQUEST|COOKIE)\b",
    r"(?i)\bshow_source\s*\(",
    r"(?i)\bhighlight_file\s*\(",
    r"(?i)\bphp_strip_whitespace\s*\(",
    r"(?i)\bget_meta_tags\s*\(",
    r"(?i)\bparse_ini_file\s*\(",
    r"(?i)\bparse_ini_string\s*\(",
    r"(?i)\bmove_uploaded_file\s*\(",
    r"(?i)\bcopy\s*\(\s*\$_(?:GET|POST|REQUEST|COOKIE)\b",
    r"(?i)\brename\s*\(\s*\$_(?:GET|POST|REQUEST|COOKIE)\b",
    r"(?i)\bunlink\s*\(\s*\$_(?:GET|POST|REQUEST|COOKIE)\b",
    r"(?i)\brmdir\s*\(\s*\$_(?:GET|POST|REQUEST|COOKIE)\b",
    r"(?i)\bmkdir\s*\(\s*\$_(?:GET|POST|REQUEST|COOKIE)\b",
    r"(?i)\bchmod\s*\(\s*\$_(?:GET|POST|REQUEST|COOKIE)\b",
    r"(?i)\bchown\s*\(\s*\$_(?:GET|POST|REQUEST|COOKIE)\b",
    r"(?i)\bglob\s*\(\s*\$_(?:GET|POST|REQUEST|COOKIE)\b",
    r"(?i)\bscandir\s*\(\s*\$_(?:GET|POST|REQUEST|COOKIE)\b",
    r"(?i)\bopendir\s*\(\s*\$_(?:GET|POST|REQUEST|COOKIE)\b",
    r"(?i)\breaddir\s*\(",
    r"(?i)\bscandir\s*\(",
    r"(?i)\bglob\s*\(\s*['\"]",
    r"(?i)\bdisk_free_space\s*\(",
    r"(?i)\bdisk_total_space\s*\(",
    r"(?i)\btempnam\s*\(",
    r"(?i)\btmpfile\s*\(",
    r"(?i)\bsymlink\s*\(",
    r"(?i)\breadlink\s*\(",
    r"(?i)\blink\s*\(",
    r"(?i)\bphpinfo\s*\(",
    r"(?i)\bphpversion\s*\(",
    r"(?i)\bphp_uname\s*\(",
    r"(?i)\bphp_sapi_name\s*\(",
    r"(?i)\bgetenv\s*\(",
    r"(?i)\bputenv\s*\(",
    r"(?i)\bgetmyuid\s*\(",
    r"(?i)\bgetmypid\s*\(",
    r"(?i)\bgetmygid\s*\(",
    r"(?i)\bget_current_user\s*\(",
    r"(?i)\bgetmyinode\s*\(",
    r"(?i)\bget_cfg_var\s*\(",
    r"(?i)\bini_set\s*\(",
    r"(?i)\bini_get\s*\(",
    r"(?i)\bini_alter\s*\(",
    r"(?i)\bini_restore\s*\(",
    r"(?i)\bset_include_path\s*\(",
    r"(?i)\bget_include_path\s*\(",
    r"(?i)\brestore_include_path\s*\(",
    r"(?i)\bset_time_limit\s*\(",
    r"(?i)\bignore_user_abort\s*\(",
    r"(?i)\bregister_shutdown_function\s*\(",
    r"(?i)\bregister_tick_function\s*\(",
    r"(?i)\bspl_autoload_register\s*\(",
    r"(?i)\bset_error_handler\s*\(",
    r"(?i)\bset_exception_handler\s*\(",
    r"(?i)\bob_start\s*\(\s*['\"](?:system|exec|passthru|shell_exec)\b",
    r"(?i)\bheader\s*\(\s*['\"]Location\s*:\s*(?:http|ftp|data|javascript)",
    r"(?i)\bsetcookie\s*\(",
    r"(?i)\bsetrawcookie\s*\(",
    r"(?i)\bsession_start\s*\(",
    r"(?i)\bsession_destroy\s*\(",
    r"(?i)\bsession_regenerate_id\s*\(",
    r"(?i)\bsession_set_save_handler\s*\(",
    r"(?i)\b\$_SESSION\s*\[\s*\$_(?:GET|POST|REQUEST|COOKIE)\b",
    r"(?i)\bmail\s*\(\s*\$_(?:GET|POST|REQUEST|COOKIE)\b",
    r"(?i)\bmail\s*\(",
    r"(?i)\bextract\s*\(\s*\$_(?:GET|POST|REQUEST|COOKIE)\b",
    r"(?i)\bparse_str\s*\(\s*\$_(?:GET|POST|REQUEST|COOKIE)\b",
    r"(?i)\bcompact\s*\(",
    r"(?i)\bvar_export\s*\(",
    r"(?i)\bprint_r\s*\(",
    r"(?i)\bvar_dump\s*\(",
    r"(?i)\bdebug_zval_refs\s*\(",
    r"(?i)\bdebug_print_backtrace\s*\(",
    r"(?i)\bpdl_load\s*\(",
    r"(?i)\bdl\s*\(",
    r"(?i)\bReflectionFunction\b",
    r"(?i)\bReflectionClass\b",
    r"(?i)\bReflectionMethod\b",
    r"(?i)\bReflectionProperty\b",
    r"(?i)\b__construct\b.*\$_(?:GET|POST|REQUEST|COOKIE)\b",
    r"(?i)\b__destruct\b",
    r"(?i)\b__wakeup\b",
    r"(?i)\b__sleep\b",
    r"(?i)\b__toString\b",
    r"(?i)\b__invoke\b",
    r"(?i)\b__call\b",
    r"(?i)\b__callStatic\b",
    r"(?i)\b__get\b",
    r"(?i)\b__set\b",
    r"(?i)\b__isset\b",
    r"(?i)\b__unset\b",
    r"(?i)\b__clone\b",
    r"(?i)\b__debugInfo\b",
    r"(?i)\b__serialize\b",
    r"(?i)\b__unserialize\b",
    r"(?i)\b__set_state\b",
    r"(?i)\bphar://\b",
    r"(?i)\bzip://\b",
    r"(?i)\bphp://filter\b",
    r"(?i)\bphp://input\b",
    r"(?i)\bphp://output\b",
    r"(?i)\bphp://stdin\b",
    r"(?i)\bphp://stdout\b",
    r"(?i)\bphp://stderr\b",
    r"(?i)\bphp://memory\b",
    r"(?i)\bphp://temp\b",
    r"(?i)\bphp://fd\b",
    r"(?i)\bdata://text/plain\b",
    r"(?i)\bdata://text/html\b",
    r"(?i)\bexpect://\b",
    r"(?i)\bcompress\.zlib://\b",
    r"(?i)\bcompress\.bzip2://\b",
    r"(?i)\bglob://\b",
    r"(?i)\bssh2\.\w+://\b",
    r"(?i)\brar://\b",
    r"(?i)\bogg://\b",
    r"(?i)convert\.base64-(?:encode|decode)\b",
    r"(?i)convert\.quoted-printable-(?:encode|decode)\b",
    r"(?i)convert\.iconv\.\w+\b",
    r"(?i)string\.rot13\b",
    r"(?i)string\.toupper\b",
    r"(?i)string\.tolower\b",
    r"(?i)string\.strip_tags\b",
    r"(?i)zlib\.(?:inflate|deflate)\b",
    r"(?i)bzip2\.(?:compress|decompress)\b",
    # PHP serialization patterns
    r"(?i)O:\d+:\"(?:SplFileObject|GlobIterator|DirectoryIterator|FilesystemIterator|RecursiveDirectoryIterator|SplFileInfo|SplTempFileObject)\"",
    r"(?i)O:\d+:\"(?:Phar|PharData|PharFileInfo)\"",
    r"(?i)O:\d+:\"(?:SimpleXMLElement|DOMDocument|DOMXPath)\"",
    r"(?i)O:\d+:\"(?:PDO|PDOStatement|mysqli|mysqli_result)\"",
    r"(?i)O:\d+:\"(?:Memcache|Memcached|Redis)\"",
    r"(?i)O:\d+:\"(?:SoapClient|SoapServer|SoapFault)\"",
    r"(?i)O:\d+:\"(?:ZipArchive|RarArchive)\"",
    r"(?i)O:\d+:\"(?:Imagick|Gmagick|GdImage)\"",
    r"(?i)O:\d+:\"(?:FFI|FFI\\\\CData|FFI\\\\CType)\"",
]

# ============================================================================
# 2. JAVA / SPRING / STRUTS DEEP (200 patterns)
# ============================================================================
JAVA_DEEP = [
    r"(?i)java\.lang\.Runtime\.getRuntime\(\)\.exec\(",
    r"(?i)java\.lang\.ProcessBuilder\b",
    r"(?i)java\.lang\.ClassLoader\b",
    r"(?i)java\.lang\.reflect\.Method\b",
    r"(?i)java\.lang\.reflect\.Field\b",
    r"(?i)java\.lang\.reflect\.Constructor\b",
    r"(?i)java\.lang\.reflect\.Proxy\b",
    r"(?i)java\.lang\.reflect\.InvocationHandler\b",
    r"(?i)java\.lang\.Thread\b",
    r"(?i)java\.lang\.ThreadGroup\b",
    r"(?i)java\.lang\.System\.exit\b",
    r"(?i)java\.lang\.System\.getProperty\b",
    r"(?i)java\.lang\.System\.getenv\b",
    r"(?i)java\.lang\.System\.setProperty\b",
    r"(?i)java\.lang\.System\.setSecurityManager\b",
    r"(?i)java\.lang\.SecurityManager\b",
    r"(?i)java\.io\.File\b",
    r"(?i)java\.io\.FileInputStream\b",
    r"(?i)java\.io\.FileOutputStream\b",
    r"(?i)java\.io\.FileReader\b",
    r"(?i)java\.io\.FileWriter\b",
    r"(?i)java\.io\.BufferedReader\b",
    r"(?i)java\.io\.BufferedWriter\b",
    r"(?i)java\.io\.RandomAccessFile\b",
    r"(?i)java\.io\.ObjectInputStream\b",
    r"(?i)java\.io\.ObjectOutputStream\b",
    r"(?i)java\.io\.PipedInputStream\b",
    r"(?i)java\.io\.PipedOutputStream\b",
    r"(?i)java\.net\.URL\b",
    r"(?i)java\.net\.URLConnection\b",
    r"(?i)java\.net\.HttpURLConnection\b",
    r"(?i)java\.net\.Socket\b",
    r"(?i)java\.net\.ServerSocket\b",
    r"(?i)java\.net\.DatagramSocket\b",
    r"(?i)java\.net\.InetAddress\b",
    r"(?i)java\.net\.URLClassLoader\b",
    r"(?i)javax\.naming\.InitialContext\b",
    r"(?i)javax\.naming\.directory\.InitialDirContext\b",
    r"(?i)javax\.naming\.ldap\.InitialLdapContext\b",
    r"(?i)javax\.script\.ScriptEngine\b",
    r"(?i)javax\.script\.ScriptEngineManager\b",
    r"(?i)javax\.xml\.parsers\.SAXParser\b",
    r"(?i)javax\.xml\.parsers\.DocumentBuilder\b",
    r"(?i)javax\.xml\.transform\.Transformer\b",
    r"(?i)javax\.el\.ExpressionFactory\b",
    r"(?i)javax\.el\.ValueExpression\b",
    r"(?i)javax\.el\.MethodExpression\b",
    r"(?i)javax\.management\.MBeanServer\b",
    r"(?i)javax\.management\.ObjectName\b",
    r"(?i)javax\.management\.remote\.JMXConnector\b",
    r"(?i)javax\.management\.remote\.JMXServiceURL\b",
    r"(?i)java\.rmi\.Naming\b",
    r"(?i)java\.rmi\.registry\.Registry\b",
    r"(?i)java\.rmi\.registry\.LocateRegistry\b",
    r"(?i)java\.rmi\.server\.UnicastRemoteObject\b",
    r"(?i)java\.beans\.XMLDecoder\b",
    r"(?i)java\.beans\.XMLEncoder\b",
    r"(?i)java\.sql\.DriverManager\b",
    r"(?i)java\.sql\.Connection\b",
    r"(?i)java\.sql\.Statement\b",
    r"(?i)java\.sql\.PreparedStatement\b",
    r"(?i)java\.sql\.CallableStatement\b",
    r"(?i)java\.sql\.ResultSet\b",
    # OGNL Injection
    r"(?i)%\{.*\}",
    r"(?i)\$\{.*\}",
    r"(?i)#\{.*\}",
    r"(?i)#(?:cmd|command|exec|runtime)\b",
    r"(?i)#_memberAccess\b",
    r"(?i)#_classResolver\b",
    r"(?i)#_ognlUtil\b",
    r"(?i)#context\b",
    r"(?i)@java\.lang\.Runtime@getRuntime\b",
    r"(?i)@java\.lang\.System@\w+",
    r"(?i)@java\.lang\.Thread@sleep\b",
    r"(?i)@java\.io\.File@\w+",
    r"(?i)@java\.net\.URL@\w+",
    r"(?i)@org\.apache\.commons\.\w+",
    r"(?i)new\s+java\.lang\.ProcessBuilder\b",
    r"(?i)new\s+java\.io\.File\b",
    r"(?i)new\s+java\.net\.URL\b",
    r"(?i)new\s+java\.net\.Socket\b",
    r"(?i)new\s+java\.util\.Scanner\b",
    r"(?i)new\s+javax\.script\.ScriptEngineManager\b",
    # SpEL
    r"(?i)T\(\s*java\.lang\.Runtime\s*\)",
    r"(?i)T\(\s*java\.lang\.ProcessBuilder\s*\)",
    r"(?i)T\(\s*java\.lang\.ClassLoader\s*\)",
    r"(?i)T\(\s*java\.lang\.System\s*\)",
    r"(?i)T\(\s*java\.lang\.Thread\s*\)",
    r"(?i)T\(\s*java\.io\.File\s*\)",
    r"(?i)T\(\s*java\.net\.URL\s*\)",
    r"(?i)T\(\s*java\.net\.InetAddress\s*\)",
    r"(?i)T\(\s*javax\.script\.ScriptEngineManager\s*\)",
    r"(?i)T\(\s*org\.springframework\.\w+\s*\)",
    r"(?i)\.getClass\(\)\.forName\(",
    r"(?i)\.getClass\(\)\.getMethod\(",
    r"(?i)\.getClass\(\)\.getDeclaredMethod\(",
    r"(?i)\.getClass\(\)\.newInstance\(",
    r"(?i)\.getClass\(\)\.getClassLoader\(",
    r"(?i)\.getClass\(\)\.getResource\(",
    # Spring-specific
    r"(?i)/spring/\w+\b",
    r"(?i)/spring-boot/\w+\b",
    r"(?i)class\.module\.classLoader\b",
    r"(?i)class\.classLoader\.resources\b",
    r"(?i)class\.classLoader\.URLs\b",
    r"(?i)spring\.datasource\.url\b",
    r"(?i)spring\.datasource\.username\b",
    r"(?i)spring\.datasource\.password\b",
    r"(?i)spring\.jpa\.properties\b",
    r"(?i)spring\.mail\.host\b",
    r"(?i)spring\.mail\.password\b",
    r"(?i)spring\.redis\.host\b",
    r"(?i)spring\.redis\.password\b",
    r"(?i)spring\.cloud\.config\b",
    r"(?i)spring\.profiles\.active\b",
    r"(?i)management\.endpoints\.web\b",
    r"(?i)eureka\.client\.serviceUrl\b",
    r"(?i)zuul\.routes\.\w+\b",
    r"(?i)ribbon\.eureka\.enabled\b",
    r"(?i)hystrix\.command\.\w+\b",
    r"(?i)feign\.client\.config\b",
    # Struts-specific
    r"(?i)struts\.devMode\b",
    r"(?i)struts\.enable\.DynamicMethodInvocation\b",
    r"(?i)struts\.mapper\.alwaysSelectFullNamespace\b",
    r"(?i)struts\.ognl\.allowStaticMethodAccess\b",
    r"(?i)struts\.ognl\.allowStaticFieldAccess\b",
    r"(?i)struts\.action\.extension\b",
    r"(?i)struts\.multipart\.maxSize\b",
    r"(?i)struts\.custom\.i18n\.resources\b",
    # Log4j
    r"(?i)\$\{jndi:ldap://",
    r"(?i)\$\{jndi:rmi://",
    r"(?i)\$\{jndi:dns://",
    r"(?i)\$\{jndi:iiop://",
    r"(?i)\$\{jndi:corba://",
    r"(?i)\$\{jndi:nds://",
    r"(?i)\$\{jndi:nis://",
    r"(?i)\$\{jndi:ldaps://",
    r"(?i)\$\{\w*j\w*n\w*d\w*i\w*:",
    r"(?i)\$\{(?:lower|upper|env|sys|date|main|marker|java|bundle|ctx|log4j|map|sd|web):.*\}",
    r"(?i)\$\{.*\$\{.*\}.*\}",
    r"(?i)\$\{env:\w+\}",
    r"(?i)\$\{sys:\w+\}",
    r"(?i)\$\{java:version\}",
    r"(?i)\$\{java:runtime\}",
    r"(?i)\$\{java:os\}",
    r"(?i)\$\{java:hw\}",
    r"(?i)\$\{java:locale\}",
    r"(?i)\$\{hostName\}",
    r"(?i)\$\{docker:\w+\}",
    r"(?i)\$\{k8s:\w+\}",
    r"(?i)\$\{spring:\w+\}",
    r"(?i)\$\{bundle:\w+\}",
]

# ============================================================================
# 3. PYTHON / RUBY / NODE.JS DEEP (250 patterns)
# ============================================================================
SCRIPTING_DEEP = [
    # Python
    r"(?i)\bimport\s+os\b",
    r"(?i)\bimport\s+sys\b",
    r"(?i)\bimport\s+subprocess\b",
    r"(?i)\bimport\s+socket\b",
    r"(?i)\bimport\s+shutil\b",
    r"(?i)\bimport\s+signal\b",
    r"(?i)\bimport\s+ctypes\b",
    r"(?i)\bimport\s+pickle\b",
    r"(?i)\bimport\s+marshal\b",
    r"(?i)\bimport\s+shelve\b",
    r"(?i)\bimport\s+yaml\b",
    r"(?i)\bimport\s+code\b",
    r"(?i)\bimport\s+codeop\b",
    r"(?i)\bimport\s+compile\b",
    r"(?i)\bimport\s+compileall\b",
    r"(?i)\bimport\s+pty\b",
    r"(?i)\bimport\s+commands\b",
    r"(?i)\bimport\s+pdb\b",
    r"(?i)\bimport\s+trace\b",
    r"(?i)\bimport\s+webbrowser\b",
    r"(?i)\bimport\s+tempfile\b",
    r"(?i)\bimport\s+glob\b",
    r"(?i)\bimport\s+fnmatch\b",
    r"(?i)\bimport\s+shlex\b",
    r"(?i)\bimport\s+resource\b",
    r"(?i)\bimport\s+platform\b",
    r"(?i)\bfrom\s+os\s+import\b",
    r"(?i)\bfrom\s+subprocess\s+import\b",
    r"(?i)\bfrom\s+socket\s+import\b",
    r"(?i)\bfrom\s+pickle\s+import\b",
    r"(?i)\bfrom\s+marshal\s+import\b",
    r"(?i)\bfrom\s+ctypes\s+import\b",
    r"(?i)\bfrom\s+multiprocessing\s+import\b",
    r"(?i)\bfrom\s+threading\s+import\b",
    r"(?i)\bfrom\s+xml\.etree\s+import\b",
    r"(?i)\bos\.system\s*\(",
    r"(?i)\bos\.popen\s*\(",
    r"(?i)\bos\.popen2\s*\(",
    r"(?i)\bos\.popen3\s*\(",
    r"(?i)\bos\.popen4\s*\(",
    r"(?i)\bos\.exec[a-z]+\s*\(",
    r"(?i)\bos\.spawn[a-z]+\s*\(",
    r"(?i)\bos\.fork\s*\(",
    r"(?i)\bos\.kill\s*\(",
    r"(?i)\bos\.unlink\s*\(",
    r"(?i)\bos\.remove\s*\(",
    r"(?i)\bos\.rmdir\s*\(",
    r"(?i)\bos\.rename\s*\(",
    r"(?i)\bos\.chmod\s*\(",
    r"(?i)\bos\.chown\s*\(",
    r"(?i)\bos\.mkdir\s*\(",
    r"(?i)\bos\.makedirs\s*\(",
    r"(?i)\bos\.listdir\s*\(",
    r"(?i)\bos\.walk\s*\(",
    r"(?i)\bos\.scandir\s*\(",
    r"(?i)\bos\.environ\b",
    r"(?i)\bos\.getenv\s*\(",
    r"(?i)\bos\.putenv\s*\(",
    r"(?i)\bos\.path\.exists\s*\(",
    r"(?i)\bos\.path\.join\s*\(",
    r"(?i)\bsubprocess\.call\s*\(",
    r"(?i)\bsubprocess\.check_call\s*\(",
    r"(?i)\bsubprocess\.check_output\s*\(",
    r"(?i)\bsubprocess\.run\s*\(",
    r"(?i)\bsubprocess\.Popen\s*\(",
    r"(?i)\bsubprocess\.getoutput\s*\(",
    r"(?i)\bsubprocess\.getstatusoutput\s*\(",
    r"(?i)\b__import__\s*\(\s*['\"]os['\"]",
    r"(?i)\b__import__\s*\(\s*['\"]subprocess['\"]",
    r"(?i)\b__import__\s*\(\s*['\"]socket['\"]",
    r"(?i)\b__import__\s*\(\s*['\"]shutil['\"]",
    r"(?i)\b__import__\s*\(\s*['\"]pickle['\"]",
    r"(?i)\b__import__\s*\(\s*['\"]ctypes['\"]",
    r"(?i)\b__import__\s*\(\s*['\"]pty['\"]",
    r"(?i)\beval\s*\(\s*(?:input|raw_input)\b",
    r"(?i)\bexec\s*\(\s*(?:input|raw_input)\b",
    r"(?i)\bcompile\s*\(\s*(?:input|raw_input)\b",
    r"(?i)\bbreakpoint\s*\(",
    r"(?i)\bopen\s*\(\s*['\"](?:/etc/|/proc/|/dev/|/root/|/home/|C:\\\\)",
    # Ruby
    r"(?i)\bsystem\s*\(\s*['\"]",
    r"(?i)\bexec\s*\(\s*['\"]",
    r"(?i)\b`[^`]*`",
    r"(?i)\bKernel\.system\b",
    r"(?i)\bKernel\.exec\b",
    r"(?i)\bKernel\.open\b",
    r"(?i)\bKernel\.spawn\b",
    r"(?i)\bKernel\.fork\b",
    r"(?i)\bIO\.popen\b",
    r"(?i)\bIO\.read\b",
    r"(?i)\bIO\.write\b",
    r"(?i)\bIO\.sysopen\b",
    r"(?i)\bOpen3\.popen3\b",
    r"(?i)\bOpen3\.popen2\b",
    r"(?i)\bOpen3\.capture3\b",
    r"(?i)\bOpen3\.capture2\b",
    r"(?i)\bProcess\.spawn\b",
    r"(?i)\bProcess\.fork\b",
    r"(?i)\bProcess\.kill\b",
    r"(?i)\bFile\.open\b",
    r"(?i)\bFile\.read\b",
    r"(?i)\bFile\.write\b",
    r"(?i)\bFile\.delete\b",
    r"(?i)\bFile\.unlink\b",
    r"(?i)\bFile\.rename\b",
    r"(?i)\bFile\.chmod\b",
    r"(?i)\bFile\.chown\b",
    r"(?i)\bFile\.exist\?\b",
    r"(?i)\bFileUtils\.\w+\b",
    r"(?i)\bDir\.glob\b",
    r"(?i)\bDir\.entries\b",
    r"(?i)\bDir\.foreach\b",
    r"(?i)\bDir\.mkdir\b",
    r"(?i)\bDir\.rmdir\b",
    r"(?i)\bDir\.chdir\b",
    r"(?i)\bDir\.pwd\b",
    r"(?i)\bDir\.home\b",
    r"(?i)\bMarshal\.load\b",
    r"(?i)\bMarshal\.dump\b",
    r"(?i)\bYAML\.load\b",
    r"(?i)\bYAML\.unsafe_load\b",
    r"(?i)\bERB\.new\b",
    r"(?i)\b\.send\s*\(\s*['\"](?:system|exec|eval|send|public_send)\b",
    r"(?i)\b\.public_send\s*\(\s*['\"]",
    r"(?i)\b\.instance_eval\b",
    r"(?i)\b\.class_eval\b",
    r"(?i)\b\.module_eval\b",
    r"(?i)\b\.const_get\b",
    r"(?i)\b\.method\s*\(",
    r"(?i)\bObjectSpace\.\w+\b",
    r"(?i)\bBinding\.\w+\b",
    r"(?i)\brequire\s+['\"](?:open-uri|net/http|socket|webrick|drb|erb|yaml|json|rexml|fiddle|etc|shellwords)\b",
    # Node.js
    r"(?i)\brequire\s*\(\s*['\"]child_process['\"]",
    r"(?i)\brequire\s*\(\s*['\"]fs['\"]",
    r"(?i)\brequire\s*\(\s*['\"]path['\"]",
    r"(?i)\brequire\s*\(\s*['\"]os['\"]",
    r"(?i)\brequire\s*\(\s*['\"]net['\"]",
    r"(?i)\brequire\s*\(\s*['\"]http['\"]",
    r"(?i)\brequire\s*\(\s*['\"]https['\"]",
    r"(?i)\brequire\s*\(\s*['\"]crypto['\"]",
    r"(?i)\brequire\s*\(\s*['\"]stream['\"]",
    r"(?i)\brequire\s*\(\s*['\"]dgram['\"]",
    r"(?i)\brequire\s*\(\s*['\"]cluster['\"]",
    r"(?i)\brequire\s*\(\s*['\"]vm['\"]",
    r"(?i)\brequire\s*\(\s*['\"]repl['\"]",
    r"(?i)\brequire\s*\(\s*['\"]readline['\"]",
    r"(?i)\brequire\s*\(\s*['\"]dns['\"]",
    r"(?i)\brequire\s*\(\s*['\"]tls['\"]",
    r"(?i)\brequire\s*\(\s*['\"]process['\"]",
    r"(?i)\brequire\s*\(\s*['\"]util['\"]",
    r"(?i)\brequire\s*\(\s*['\"]assert['\"]",
    r"(?i)\brequire\s*\(\s*['\"]zlib['\"]",
    r"(?i)\bchild_process\.exec\b",
    r"(?i)\bchild_process\.execSync\b",
    r"(?i)\bchild_process\.execFile\b",
    r"(?i)\bchild_process\.execFileSync\b",
    r"(?i)\bchild_process\.spawn\b",
    r"(?i)\bchild_process\.spawnSync\b",
    r"(?i)\bchild_process\.fork\b",
    r"(?i)\bprocess\.env\b",
    r"(?i)\bprocess\.argv\b",
    r"(?i)\bprocess\.cwd\b",
    r"(?i)\bprocess\.chdir\b",
    r"(?i)\bprocess\.exit\b",
    r"(?i)\bprocess\.kill\b",
    r"(?i)\bprocess\.pid\b",
    r"(?i)\bprocess\.ppid\b",
    r"(?i)\bprocess\.platform\b",
    r"(?i)\bprocess\.arch\b",
    r"(?i)\bprocess\.version\b",
    r"(?i)\bprocess\.versions\b",
    r"(?i)\bprocess\.execPath\b",
    r"(?i)\bprocess\.mainModule\b",
    r"(?i)\bprocess\.binding\b",
    r"(?i)\bprocess\._linkedBinding\b",
    r"(?i)\bfs\.readFile\b",
    r"(?i)\bfs\.readFileSync\b",
    r"(?i)\bfs\.writeFile\b",
    r"(?i)\bfs\.writeFileSync\b",
    r"(?i)\bfs\.appendFile\b",
    r"(?i)\bfs\.appendFileSync\b",
    r"(?i)\bfs\.unlink\b",
    r"(?i)\bfs\.unlinkSync\b",
    r"(?i)\bfs\.readdir\b",
    r"(?i)\bfs\.readdirSync\b",
    r"(?i)\bfs\.mkdir\b",
    r"(?i)\bfs\.mkdirSync\b",
    r"(?i)\bfs\.rmdir\b",
    r"(?i)\bfs\.rmdirSync\b",
    r"(?i)\bfs\.rename\b",
    r"(?i)\bfs\.renameSync\b",
    r"(?i)\bfs\.chmod\b",
    r"(?i)\bfs\.chown\b",
    r"(?i)\bfs\.stat\b",
    r"(?i)\bfs\.statSync\b",
    r"(?i)\bfs\.createReadStream\b",
    r"(?i)\bfs\.createWriteStream\b",
    r"(?i)\bvm\.runInNewContext\b",
    r"(?i)\bvm\.runInThisContext\b",
    r"(?i)\bvm\.runInContext\b",
    r"(?i)\bvm\.createContext\b",
    r"(?i)\bvm\.compileFunction\b",
    r"(?i)\bvm\.Script\b",
    r"(?i)__proto__\b",
    r"(?i)constructor\.prototype\b",
    r"(?i)Object\.prototype\b",
    r"(?i)prototype\.constructor\b",
    r"(?i)\.__proto__\s*=",
    r"(?i)\[\"__proto__\"\]\s*=",
    r"(?i)\['__proto__'\]\s*=",
    r"(?i)\[\"constructor\"\]\s*\[\"prototype\"\]",
    r"(?i)\['constructor'\]\s*\['prototype'\]",
    r"(?i)Object\.assign\s*\(\s*\{\}",
    r"(?i)Object\.defineProperty\b",
    r"(?i)Object\.defineProperties\b",
    r"(?i)Object\.setPrototypeOf\b",
    r"(?i)Object\.getPrototypeOf\b",
    r"(?i)Reflect\.construct\b",
    r"(?i)Reflect\.apply\b",
    r"(?i)Reflect\.defineProperty\b",
    r"(?i)Reflect\.deleteProperty\b",
    r"(?i)Reflect\.get\b",
    r"(?i)Reflect\.set\b",
    r"(?i)Reflect\.getPrototypeOf\b",
    r"(?i)Reflect\.setPrototypeOf\b",
    r"(?i)Buffer\.from\s*\(\s*['\"]",
    r"(?i)Buffer\.alloc\s*\(\s*\d+",
    r"(?i)Buffer\.allocUnsafe\b",
]

# ============================================================================
# 4. CLOUD & CONTAINER ESCAPE DEEP (200 patterns)
# ============================================================================
CLOUD_CONTAINER_DEEP = [
    # AWS
    r"(?i)AKIA[0-9A-Z]{16}\b",
    r"(?i)ASIA[0-9A-Z]{16}\b",
    r"(?i)AIDA[0-9A-Z]{16}\b",
    r"(?i)AROA[0-9A-Z]{16}\b",
    r"(?i)ANPA[0-9A-Z]{16}\b",
    r"(?i)ANVA[0-9A-Z]{16}\b",
    r"(?i)AGPA[0-9A-Z]{16}\b",
    r"(?i)APKA[0-9A-Z]{16}\b",
    r"(?i)AIPA[0-9A-Z]{16}\b",
    r"(?i)aws_access_key_id\s*=\s*\w+",
    r"(?i)aws_secret_access_key\s*=\s*\w+",
    r"(?i)aws_session_token\s*=\s*\w+",
    r"(?i)AWS_ACCESS_KEY_ID\s*=\s*\w+",
    r"(?i)AWS_SECRET_ACCESS_KEY\s*=\s*\w+",
    r"(?i)AWS_SESSION_TOKEN\s*=\s*\w+",
    r"(?i)AWS_DEFAULT_REGION\s*=\s*\w+",
    r"(?i)AWS_SECURITY_TOKEN\s*=\s*\w+",
    r"(?i)169\.254\.169\.254/latest/meta-data\b",
    r"(?i)169\.254\.169\.254/latest/user-data\b",
    r"(?i)169\.254\.169\.254/latest/api/token\b",
    r"(?i)169\.254\.169\.254/latest/dynamic/instance-identity\b",
    r"(?i)169\.254\.170\.2/v2/credentials\b",
    r"(?i)\.amazonaws\.com/\b",
    r"(?i)\.s3\.amazonaws\.com\b",
    r"(?i)s3://\w+\b",
    r"(?i)s3\.amazonaws\.com/\w+\b",
    r"(?i)\.s3-\w+-\w+\.amazonaws\.com\b",
    r"(?i)\.execute-api\.\w+-\w+-\d\.amazonaws\.com\b",
    r"(?i)\.elasticbeanstalk\.com\b",
    r"(?i)\.elb\.amazonaws\.com\b",
    r"(?i)\.cloudfront\.net\b",
    r"(?i)\.lambda\.amazonaws\.com\b",
    r"(?i)arn:aws:(?:iam|s3|ec2|lambda|rds|dynamodb|sqs|sns|sts|kms|secretsmanager)\b",
    # GCP
    r"(?i)metadata\.google\.internal/computeMetadata/v1\b",
    r"(?i)metadata\.google\.internal/computeMetadata/v1/instance\b",
    r"(?i)metadata\.google\.internal/computeMetadata/v1/project\b",
    r"(?i)169\.254\.169\.254/computeMetadata/v1\b",
    r"(?i)GOOGLE_APPLICATION_CREDENTIALS\s*=",
    r"(?i)GOOGLE_CLOUD_PROJECT\s*=",
    r"(?i)GCLOUD_PROJECT\s*=",
    r"(?i)GCP_PROJECT\s*=",
    r"(?i)GOOGLE_API_KEY\s*=",
    r"(?i)FIREBASE_API_KEY\s*=",
    r"(?i)\.googleapis\.com\b",
    r"(?i)\.appspot\.com\b",
    r"(?i)\.firebaseio\.com\b",
    r"(?i)\.firebaseapp\.com\b",
    r"(?i)\.cloudfunctions\.net\b",
    r"(?i)\.run\.app\b",
    r"(?i)storage\.googleapis\.com\b",
    r"(?i)gs://\w+\b",
    # Azure
    r"(?i)169\.254\.169\.254/metadata/instance\b",
    r"(?i)169\.254\.169\.254/metadata/identity\b",
    r"(?i)AZURE_CLIENT_ID\s*=",
    r"(?i)AZURE_CLIENT_SECRET\s*=",
    r"(?i)AZURE_TENANT_ID\s*=",
    r"(?i)AZURE_SUBSCRIPTION_ID\s*=",
    r"(?i)AZURE_STORAGE_ACCOUNT\s*=",
    r"(?i)AZURE_STORAGE_KEY\s*=",
    r"(?i)AZURE_STORAGE_CONNECTION_STRING\s*=",
    r"(?i)\.blob\.core\.windows\.net\b",
    r"(?i)\.table\.core\.windows\.net\b",
    r"(?i)\.queue\.core\.windows\.net\b",
    r"(?i)\.file\.core\.windows\.net\b",
    r"(?i)\.database\.windows\.net\b",
    r"(?i)\.azurewebsites\.net\b",
    r"(?i)\.azurecr\.io\b",
    r"(?i)\.vault\.azure\.net\b",
    r"(?i)\.servicebus\.windows\.net\b",
    r"(?i)\.documents\.azure\.com\b",
    r"(?i)\.search\.windows\.net\b",
    # Kubernetes
    r"(?i)/api/v1/namespaces\b",
    r"(?i)/api/v1/pods\b",
    r"(?i)/api/v1/services\b",
    r"(?i)/api/v1/secrets\b",
    r"(?i)/api/v1/configmaps\b",
    r"(?i)/api/v1/nodes\b",
    r"(?i)/api/v1/persistentvolumes\b",
    r"(?i)/api/v1/serviceaccounts\b",
    r"(?i)/apis/apps/v1/deployments\b",
    r"(?i)/apis/apps/v1/replicasets\b",
    r"(?i)/apis/apps/v1/statefulsets\b",
    r"(?i)/apis/apps/v1/daemonsets\b",
    r"(?i)/apis/batch/v1/jobs\b",
    r"(?i)/apis/batch/v1/cronjobs\b",
    r"(?i)/apis/networking\.k8s\.io/v1/ingresses\b",
    r"(?i)/apis/networking\.k8s\.io/v1/networkpolicies\b",
    r"(?i)/apis/rbac\.authorization\.k8s\.io/v1/clusterroles\b",
    r"(?i)/apis/rbac\.authorization\.k8s\.io/v1/clusterrolebindings\b",
    r"(?i)/apis/rbac\.authorization\.k8s\.io/v1/roles\b",
    r"(?i)/apis/rbac\.authorization\.k8s\.io/v1/rolebindings\b",
    r"(?i)KUBERNETES_SERVICE_HOST\s*=",
    r"(?i)KUBERNETES_PORT\s*=",
    r"(?i)KUBERNETES_SERVICE_PORT\s*=",
    r"(?i)/var/run/secrets/kubernetes\.io/serviceaccount/token\b",
    r"(?i)/var/run/secrets/kubernetes\.io/serviceaccount/ca\.crt\b",
    r"(?i)/var/run/secrets/kubernetes\.io/serviceaccount/namespace\b",
    # Docker
    r"(?i)/var/run/docker\.sock\b",
    r"(?i)/run/docker\.sock\b",
    r"(?i)DOCKER_HOST\s*=",
    r"(?i)DOCKER_TLS_VERIFY\s*=",
    r"(?i)DOCKER_CERT_PATH\s*=",
    r"(?i)DOCKER_API_VERSION\s*=",
    r"(?i)/v\d+\.\d+/containers/json\b",
    r"(?i)/v\d+\.\d+/containers/create\b",
    r"(?i)/v\d+\.\d+/containers/\w+/start\b",
    r"(?i)/v\d+\.\d+/containers/\w+/stop\b",
    r"(?i)/v\d+\.\d+/containers/\w+/kill\b",
    r"(?i)/v\d+\.\d+/containers/\w+/exec\b",
    r"(?i)/v\d+\.\d+/containers/\w+/logs\b",
    r"(?i)/v\d+\.\d+/containers/\w+/attach\b",
    r"(?i)/v\d+\.\d+/images/json\b",
    r"(?i)/v\d+\.\d+/images/create\b",
    r"(?i)/v\d+\.\d+/images/\w+/push\b",
    r"(?i)/v\d+\.\d+/volumes\b",
    r"(?i)/v\d+\.\d+/networks\b",
    r"(?i)/v\d+\.\d+/secrets\b",
    r"(?i)/v\d+\.\d+/configs\b",
    r"(?i)/v\d+\.\d+/swarm\b",
    r"(?i)/v\d+\.\d+/nodes\b",
    r"(?i)/v\d+\.\d+/services\b",
    r"(?i)/v\d+\.\d+/tasks\b",
    r"(?i)/v\d+\.\d+/plugins\b",
    r"(?i)/v\d+\.\d+/system/info\b",
    r"(?i)/v\d+\.\d+/version\b",
    r"(?i)/v\d+\.\d+/events\b",
    r"(?i)/v\d+\.\d+/exec/\w+/start\b",
    # Container escape patterns
    r"(?i)nsenter\s+--target\s+1\b",
    r"(?i)nsenter\s+--mount\b",
    r"(?i)nsenter\s+--pid\b",
    r"(?i)nsenter\s+--net\b",
    r"(?i)nsenter\s+--uts\b",
    r"(?i)nsenter\s+--ipc\b",
    r"(?i)mount\s+--bind\b",
    r"(?i)mount\s+-t\s+proc\b",
    r"(?i)mount\s+-t\s+sysfs\b",
    r"(?i)mount\s+-t\s+cgroup\b",
    r"(?i)/sys/fs/cgroup\b",
    r"(?i)/sys/kernel/\b",
    r"(?i)/sys/class/\b",
    r"(?i)CAP_SYS_ADMIN\b",
    r"(?i)CAP_NET_ADMIN\b",
    r"(?i)CAP_SYS_PTRACE\b",
    r"(?i)CAP_DAC_OVERRIDE\b",
    r"(?i)CAP_DAC_READ_SEARCH\b",
    r"(?i)CAP_FOWNER\b",
    r"(?i)CAP_NET_RAW\b",
    r"(?i)CAP_SYS_RAWIO\b",
    r"(?i)CAP_SYS_MODULE\b",
    r"(?i)CAP_MKNOD\b",
    r"(?i)--privileged\b",
    r"(?i)--pid=host\b",
    r"(?i)--network=host\b",
    r"(?i)--ipc=host\b",
    r"(?i)--uts=host\b",
    r"(?i)--userns=host\b",
    r"(?i)--cap-add=SYS_ADMIN\b",
    r"(?i)--cap-add=ALL\b",
    r"(?i)--security-opt\s+(?:seccomp=unconfined|apparmor=unconfined|label=disable)\b",
]

# ============================================================================
# 5. EMAIL / LOG / HEADER INJECTION (150 patterns)
# ============================================================================
INJECT_MISC = [
    # Email injection
    r"(?i)(?:to|cc|bcc|from|subject|reply-to|return-path|sender|x-mailer|content-type)\s*:\s*\w+@\w+",
    r"(?i)%0a(?:to|cc|bcc|from|subject):",
    r"(?i)%0d%0a(?:to|cc|bcc|from|subject):",
    r"(?i)\r?\n(?:to|cc|bcc|from|subject):",
    r"(?i)(?:Content-Type|MIME-Version|Content-Transfer-Encoding|Content-Disposition)\s*:\s*\w+",
    r"(?i)multipart/mixed\b",
    r"(?i)multipart/alternative\b",
    r"(?i)multipart/related\b",
    r"(?i)boundary=\w+",
    r"(?i)filename=['\"]?\w+\.\w+['\"]?",
    r"(?i)name=['\"]?\w+\.\w+['\"]?",
    r"(?i)application/octet-stream\b",
    r"(?i)application/x-msdownload\b",
    r"(?i)application/x-msdos-program\b",
    r"(?i)text/x-shellscript\b",
    r"(?i)text/x-perl\b",
    r"(?i)text/x-python\b",
    r"(?i)text/x-ruby\b",
    r"(?i)text/x-php\b",
    r"(?i)application/x-httpd-php\b",
    # Log injection
    r"(?i)%0a\s*(?:INFO|WARN|ERROR|DEBUG|TRACE|FATAL|CRITICAL|EMERGENCY|ALERT|NOTICE)\b",
    r"(?i)%0d%0a\s*(?:INFO|WARN|ERROR|DEBUG|TRACE|FATAL|CRITICAL|EMERGENCY|ALERT|NOTICE)\b",
    r"(?i)\r?\n\s*(?:INFO|WARN|ERROR|DEBUG|TRACE|FATAL|CRITICAL|EMERGENCY|ALERT|NOTICE)\b.*(?:user|admin|root|login|auth|pass|token|session|cookie)\b",
    r"(?i)\x1b\[\d+(?:;\d+)*m",
    r"(?i)%1b\[\d+(?:;\d+)*m",
    r"(?i)\\x1b\[\d+(?:;\d+)*m",
    r"(?i)\\u001b\[\d+(?:;\d+)*m",
    r"(?i)\\033\[\d+(?:;\d+)*m",
    # Open Redirect
    r"(?i)(?:url|redirect|return|next|goto|target|destination|redir|forward|location|continue|path|uri|link|ref|callback|return_url|redirect_url|redirect_uri|return_to|returnTo|continue_url|next_url|success_url|failure_url|error_url|login_url|logout_url|register_url|signup_url|checkout_url|payment_url)\s*=\s*(?:https?://|//|\\\\/\\\\/|%(?:2f|5c){2})",
    r"(?i)(?:url|redirect|return|next|goto|target|destination|redir|forward|location)\s*=\s*(?:https?%3A%2F%2F|%2F%2F)",
    r"(?i)(?:url|redirect|return|next|goto|target|destination|redir|forward|location)\s*=\s*(?:java|data|vbscript):",
    # CORS abuse
    r"(?i)Origin\s*:\s*(?:null|https?://evil|https?://attacker|https?://malicious|https?://localhost|https?://127\.0\.0\.1|https?://\[::1\])\b",
    r"(?i)Access-Control-Allow-Origin\s*:\s*\*",
    r"(?i)Access-Control-Allow-Origin\s*:\s*null",
    r"(?i)Access-Control-Allow-Credentials\s*:\s*true",
    r"(?i)Access-Control-Allow-Methods\s*:\s*(?:.*\bPUT\b|.*\bDELETE\b|.*\bPATCH\b)",
    r"(?i)Access-Control-Allow-Headers\s*:\s*\*",
    r"(?i)Access-Control-Expose-Headers\s*:\s*\*",
    r"(?i)Access-Control-Max-Age\s*:\s*\d{5,}",
    # HPP (HTTP Parameter Pollution) - requires SAME param name repeated
    r"(?i)(?:\?|&)(\w+)=\w+&\1=\w+",
    r"(?i)(?:\?|&)((?:id|user|email|name|password|token|key|session|auth|admin|role|type|action|cmd|exec|query|search|filter|sort|order|limit|offset|page|size|count|fields|select|include|exclude|expand|embed|format|callback|redirect|url|next|return|goto|target|destination))\s*=.*&\1\s*=",
    # SSI (Server-Side Includes)
    r"(?i)<!--\s*#\s*(?:include|exec|config|echo|fsize|flastmod|printenv|set)\b",
    r"(?i)<!--\s*#\s*include\s+(?:virtual|file)\s*=",
    r"(?i)<!--\s*#\s*exec\s+(?:cmd|cgi)\s*=",
    r"(?i)<!--\s*#\s*config\s+(?:errmsg|sizefmt|timefmt)\s*=",
    r"(?i)<!--\s*#\s*echo\s+var\s*=",
    r"(?i)<!--\s*#\s*set\s+var\s*=",
    # WebSocket injection
    r"(?i)\"type\"\s*:\s*\"subscribe\"",
    r"(?i)\"type\"\s*:\s*\"unsubscribe\"",
    r"(?i)\"type\"\s*:\s*\"connection_init\"",
    r"(?i)\"type\"\s*:\s*\"connection_terminate\"",
    r"(?i)\"type\"\s*:\s*\"start\"",
    r"(?i)\"type\"\s*:\s*\"stop\"",
    r"(?i)\"type\"\s*:\s*\"data\"",
    r"(?i)\"type\"\s*:\s*\"error\"",
    r"(?i)\"type\"\s*:\s*\"complete\"",
    r"(?i)\"type\"\s*:\s*\"ka\"",
    r"(?i)\"type\"\s*:\s*\"ping\"",
    r"(?i)\"type\"\s*:\s*\"pong\"",
    # JWT attacks
    r"(?i)eyJ[a-zA-Z0-9_-]+\.eyJ[a-zA-Z0-9_-]+\.",
    r"(?i)\"alg\"\s*:\s*\"(?:none|None|NONE|nOnE)\"",
    r"(?i)\"alg\"\s*:\s*\"HS(?:256|384|512)\".*\"typ\"\s*:\s*\"JWT\"",
    r"(?i)\"kid\"\s*:\s*\"(?:.*(?:;|&&|\||`|\$\(|%0a|%0d|\\r|\\n|/dev/null|/etc/passwd|/proc))",
    r"(?i)\"jku\"\s*:\s*\"(?:http://|https://(?!(?:login|accounts|auth)\.))",
    r"(?i)\"x5u\"\s*:\s*\"(?:http://|https://(?!(?:login|accounts|auth)\.))",
    r"(?i)\"x5c\"\s*:\s*\[\"",
    r"(?i)\"jwk\"\s*:\s*\{",
    # GraphQL abuse
    r"(?i)__schema\s*\{",
    r"(?i)__type\s*\{",
    r"(?i)__typename\b",
    r"(?i)query\s+IntrospectionQuery\b",
    r"(?i)query\s*\{\s*__schema\b",
    r"(?i)mutation\s*\{",
    r"(?i)subscription\s*\{",
    r"(?i)fragment\s+\w+\s+on\s+\w+\b",
    r"(?i)\.\.\.(?:on\s+\w+|\w+)",
    r"(?i)\{\s*\w+\s*\(\s*(?:first|last|before|after|skip|take|offset|limit)\s*:\s*\d{4,}",
    r"(?i)\{\s*\w+\s*\{.*\{\s*\w+\s*\{.*\{\s*\w+\s*\{",
    # Business logic
    r"(?i)price\s*=\s*(?:0|0\.0+|-\d+)\b",
    r"(?i)quantity\s*=\s*(?:0|-\d+|999999)\b",
    r"(?i)amount\s*=\s*(?:0|0\.0+|-\d+)\b",
    r"(?i)discount\s*=\s*(?:100|1000|\d{3,})\b",
    r"(?i)total\s*=\s*(?:0|0\.0+|-\d+)\b",
    r"(?i)role\s*=\s*(?:admin|administrator|root|superuser|superadmin|system)\b",
    r"(?i)is_admin\s*=\s*(?:true|1|yes)\b",
    r"(?i)is_superuser\s*=\s*(?:true|1|yes)\b",
    r"(?i)privilege\s*=\s*(?:admin|high|root|system)\b",
    r"(?i)access_level\s*=\s*(?:\d+|admin|root|unlimited)\b",
    r"(?i)user_type\s*=\s*(?:admin|staff|internal|system)\b",
    r"(?i)account_type\s*=\s*(?:premium|enterprise|admin|unlimited)\b",
    r"(?i)status\s*=\s*(?:active|approved|verified|confirmed)\b",
    r"(?i)verified\s*=\s*(?:true|1|yes)\b",
    r"(?i)approved\s*=\s*(?:true|1|yes)\b",
    r"(?i)enabled\s*=\s*(?:true|1|yes)\b",
    r"(?i)locked\s*=\s*(?:false|0|no)\b",
    r"(?i)banned\s*=\s*(?:false|0|no)\b",
    r"(?i)suspended\s*=\s*(?:false|0|no)\b",
]

# ============================================================================
# 6. REGEX DOS / REDOS PATTERNS (100 patterns)
# ============================================================================
REDOS_PATTERNS = [
    r"(?i)(?:\w+\+){20,}",
    r"(?i)(?:[a-z]+\.){20,}",
    r"(?i)(?:\d+\.){20,}",
    r"(?i)\w{100,}",
    r"(?i)[a-z]{100,}",
    r"(?i)\d{100,}",
    r"(?i)(?:a{10,}\s+){10,}",
    r"(?i)(?:\.\*){10,}",
    r"(?i)(?:\w+\s+){50,}",
    r"(?i)(?:[^\s]+\s+){50,}",
    r"(?i).{10000,}",
    r"(?i)(?:AAAAAAAAA){1000,}",
    r"(?i)(?:0000000000){1000,}",
    r"(?i)(?:xxxxxxxxxxxx){500,}",
    r"(?i)%(?:00|01|02|03|04|05|06|07|08|09|0a|0b|0c|0d|0e|0f){100,}",
    r"(?i)(?:\\x00){100,}",
    r"(?i)(?:\\0){100,}",
    r"(?i)\x00{50,}",
    r"(?i)(?:%20){100,}",
    r"(?i)(?:\+){200,}",
    r"(?i)(?:&\w+=\w+){100,}",
    r"(?i)(?:\?|\&)\w+=(?:.{5000,})",
    # Specific ReDoS trigger patterns (high thresholds to avoid FP)
    r"(?:a{1000,})b",
    r"(?:a+){100,}b",
    r"(?:a|aa){100,}b",
    # Long repetitive payloads
    r"(?i)(?:SELECT\s+){10,}",
    r"(?i)(?:UNION\s+){10,}",
    r"(?i)(?:OR\s+){10,}",
    r"(?i)(?:AND\s+){10,}",
    r"(?i)(?:DROP\s+){10,}",
    r"(?i)(?:<script>){10,}",
    r"(?i)(?:</script>){10,}",
    r"(?i)(?:<img\s+){10,}",
    r"(?i)(?:javascript:){10,}",
    r"(?i)(?:onerror=){10,}",
    r"(?i)(?:onload=){10,}",
    r"(?i)(?:\.\./){50,}",
    r"(?i)(?:\.\.\\\\){50,}",
    r"(?i)(?:%2e%2e%2f){50,}",
    r"(?i)(?:%2e%2e/){50,}",
    r"(?i)(?:\.%2e/){50,}",
    r"(?i)(?:%2e\./){50,}",
    r"(?i)(?:%%){100,}",
    r"(?i)(?:%25){100,}",
    r"(?i)(?:\\u0000){50,}",
    r"(?i)(?:\\x00){50,}",
    r"(?i)[\x00-\x1f]{20,}",
    r"(?i)[\x80-\xff]{50,}",
    # Extremely long strings in specific contexts
    r"(?i)Cookie\s*:\s*(?:\w+=\w+;\s*){50,}",
    r"(?i)(?:Set-Cookie\s*:\s*){10,}",
    r"(?i)(?:X-\w+:\s*\w+\r?\n){50,}",
    r"(?i)Authorization\s*:\s*Bearer\s+[a-zA-Z0-9._-]{500,}",
    # Billion laughs in JSON
    r"(?i)\{(?:\s*\"\w+\"\s*:\s*\{){20,}",
    r"(?i)\[(?:\s*\[){20,}",
    # Hash DoS patterns
    r"(?i)(?:\w+=\w+&){1000,}",
    r"(?i)(?:\"[^\"]+\"\s*:\s*\"[^\"]+\"\s*,\s*){500,}",
]

RULES_MEGA_9_MAP = {
    'php_deep': PHP_DEEP,
    'java_deep': JAVA_DEEP,
    'scripting_deep': SCRIPTING_DEEP,
    'cloud_container_deep': CLOUD_CONTAINER_DEEP,
    'inject_misc': INJECT_MISC,
    'redos_patterns': REDOS_PATTERNS,
}


def get_all_mega9_patterns():
    for category, patterns in RULES_MEGA_9_MAP.items():
        for regex_str in patterns:
            yield (regex_str, category)


def count_mega9_patterns():
    return sum(len(p) for p in RULES_MEGA_9_MAP.values())
